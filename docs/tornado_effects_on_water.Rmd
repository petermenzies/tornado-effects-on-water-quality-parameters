---
title: "Effect of tornadoes on water quality parameters"
author: "Peter Menzies"
date: "10/18/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

## Load packages
library(tidyverse)
library(dataRetrieval)
library(here)
library(kableExtra)
```

## US water quality data

This study site and associated information was found using the USGS National Water Dashboard. Site information can be found at <https://waterdata.usgs.gov/nwis/uv?site_no=07263296>. The parameter codes were pulled from <https://help.waterdata.usgs.gov/parameter_cd?group_cd=%25>. Data from the NWIS web service is derived from <https://waterservices.usgs.gov/>.

### Assigning API query components

```{r}
## Maumelle River near Wye, AR - flows through Oklahoma and drains to Mississippi
## Water data back to 1989, if available.
siteNumber <- c("07263296") 

## Parameter codes for temp, discharge, turbidity, dissolved o2, and suspended sediment conc., respectively
parameterCd <- c("00010", "00060", "63680", "00300", "99409")

## Temporal range of our current study
startDate <- "1989-01-01"
endDate <- "2021-10-01"
```

### Import data from NWIS web service

```{r}
# Imports data using query components from above and changes column names to readable text
water <- readNWISdv(siteNumber, parameterCd, startDate, endDate) %>% 
  rename(water_temp_c = X_00010_00003, 
         discharge_cfs = X_00060_00003, 
         turbidity_fnu = X_63680_00003, 
         diss_o2_mgl = X_00300_00003) %>% 
  select(Date, water_temp_c, discharge_cfs, diss_o2_mgl, turbidity_fnu)
```

```{r, eval=FALSE}
# Export water data
write.csv(water, "~/Downloads/maumelle_water_2007-2021.csv")
```

### Import various embedded metadata

The following embedded metadata functions were found using the dataRetrieval package tutorial: <https://cran.r-project.org/web/packages/dataRetrieval/vignettes/dataRetrieval.html#embedded-metadata>

```{r}
# embedded metadata

# URL of API query
attr(water, "url")

# Time API accessed
attr(water, "queryTime")

# Information on the site queried
attr(water, "siteInfo")

# Names of columns
attributes(water)$names

# Variable information for water quality parameters
variableInfo <- attr(water, "variableInfo")
kable(variableInfo)
```

## US tornado data

Tornado data is retrieved from NOAA's National Weather Service found at <https://www.spc.noaa.gov/wcm/#data>.

### Read in tornado csv as data frame

```{r}
# Create data frame
tornadoes <- rnoaa::tornadoes()
```

### Exploring spatial distribution of tornadoes magnitude 3 and above near stream site

```{r}
# Creating location of monitor object
monitor = tribble(~lat, ~long,
                  34.87888889, -92.6855556)

# Filtering tornadoes based on magnitude, location, and time of ocurrance
big_T = tornadoes %>% 
  filter(mag > 2,
         slat < 36,
         slon > -95,
         yr >=2007,
         yr <= 2019) %>% 
  filter(st %in% c("AR", "KS", "NE", "OK"))

# Plotting tornado locations
T_plot = ggplot(big_T, aes(x=slon, y=slat)) +
  geom_point(aes(color=yr))

# Adding location of Maumelle stream site to plot
T_plot + geom_point(monitor, mapping = aes(x=long, y=lat), color = "red")

```

### Comparing stream measurement time-series with close-proximity tornado occurance

```{r}
mau_water_turb <- ggplot(water, aes(x = Date, y = turbidity_fnu)) +
  geom_line() +
  geom_vline(data = big_T, aes(xintercept = big_T$date), color = 'red')

mau_water_turb

mau_water_dis <- ggplot(water, aes(x = Date, y = discharge_cfs)) +
  geom_line() +
  geom_vline(data = big_T, aes(xintercept = big_T$date), color = 'red')

mau_water_dis

mau_water_o2 <- ggplot(water, aes(x = Date, y = diss_o2_mgl)) +
  geom_line() +
  geom_vline(data = big_T, aes(xintercept = big_T$date), color = 'red')

mau_water_o2

mau_water_temp <- ggplot(water, aes(x = Date, y = water_temp_c)) +
  geom_line() +
  geom_vline(data = big_T, aes(xintercept = big_T$date), color = 'red')

mau_water_temp
```

## Future Directions

The most logical next step identified by our team in order to gain better understanding of the effects of tornadoes on stream water quality beyond the data presented here would be to expand our analysis to a greater number of stream monitoring sites. This is an obvious step to expand the available data, but there are many smaller processes involved in integrating future stream data into our analysis here.

Firstly, initial exploration of stream monitoring sites has shown that data collection (both in terms of time frame and data types) is often inconsistent between monitoring sites. In order to ensure consistency of data across sites, any potential sites need to be filtered to include only those sites which match our current metrics of turbidity, sediment, dissolved oxygen, and water temperature. Furthermore, only sites which are in close proximity to a recorded tornado (and were actively monitoring during the time of that tornado) will have usable data to build upon the questions asked in this project.

The addition of more monitoring sites will involve (potentially substantial) data integration and merging. Simplification of the merging process is yet another reason to restrict expansion to those sites that track the same metrics already investigated here.

Finally, our current project is limited to one site, and therefore much of our analysis is based off of interpretation of data visualizations such as the graphs above. The integration of more datasets from other monitoring stations would provide a better basis for more robust statistical analysis that may be able to detect a more nuanced interaction between tornadoes and stream chemistry than is presented here.
